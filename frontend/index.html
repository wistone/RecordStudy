<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ä¹ æ­å­ - è®°å½•æ¯ä¸€æ­¥æˆé•¿</title>
    <link rel="stylesheet" href="styles/main.css?v=20250825-5">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <svg class="logo" viewBox="0 0 40 40" width="32" height="32">
                        <rect x="8" y="8" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="20" cy="20" r="6" fill="currentColor" opacity="0.8"/>
                    </svg>
                    <span>å­¦ä¹ æ­å­</span>
                </div>
                <div class="nav-links">
                    <a href="#/" class="nav-link active">é¦–é¡µ</a>
                    <a href="#/analytics" class="nav-link">æ•°æ®åˆ†æ</a>
                    <a href="#/records" class="nav-link">å­¦ä¹ è®°å½•</a>
                </div>
                <div class="nav-user">
                    <div class="streak-badge">
                        <span class="streak-icon">ğŸ”¥</span>
                        <span id="streakDays">0</span>å¤©
                    </div>
                    <div class="user-profile" onclick="toggleUserMenu()">
                        <div class="user-avatar">
                            <span class="avatar-icon">ğŸ‘¤</span>
                        </div>
                        <span class="user-name">å­¦ä¹ è€…</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="dropdown-arrow">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </div>
                    
                    <!-- User Menu Dropdown -->
                    <div id="userMenu" class="user-menu">
                        <div class="user-menu-header">
                            <div class="user-menu-avatar">
                                <span class="avatar-icon">ğŸ‘¤</span>
                            </div>
                            <div class="user-menu-info">
                                <div class="user-menu-name">å­¦ä¹ è€…</div>
                                <div class="user-menu-email">demo@example.com</div>
                            </div>
                        </div>
                        <div class="user-menu-divider"></div>
                        <div class="user-menu-items">
                            <a href="#" class="user-menu-item" onclick="showProfile()">
                                <span class="menu-icon">ğŸ‘¤</span>
                                ä¸ªäººèµ„æ–™
                            </a>
                            <a href="#" class="user-menu-item" onclick="showSettings()">
                                <span class="menu-icon">âš™ï¸</span>
                                è®¾ç½®
                            </a>
                            <div class="user-menu-divider"></div>
                            <a href="#" class="user-menu-item logout" onclick="handleLogout()">
                                <span class="menu-icon">ğŸšª</span>
                                é€€å‡ºç™»å½•
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main id="mainContent">
            <!-- Home Page -->
            <div id="homePage" class="page active">
                <div class="container">
                    <!-- Hero Section -->
                    <section class="hero">
                        <h1 class="hero-title">è®°å½•å­¦ä¹ ï¼Œè§è¯æˆé•¿</h1>
                        <p class="hero-subtitle">éšæ‰‹è®°å½•æ¯å¤©çš„å­¦ä¹ å†…å®¹ã€è¿›åº¦ä¸æ€è€ƒ</p>
                        <div class="hero-actions">
                            <button class="btn btn-primary btn-large" onclick="app.showQuickRecord()">
                                <span class="btn-icon">ğŸ“</span>
                                å¼€å§‹è®°å½•
                            </button>
                        </div>
                    </section>

                    <!-- Learning Summary -->
                    <section class="learning-summary">
                        <h2 class="section-title">å­¦ä¹ æ¦‚è§ˆ</h2>
                        <div class="summary-cards">
                            <div class="summary-card today">
                                <div class="card-header">
                                    <div class="card-icon">ğŸ“…</div>
                                    <div class="card-period">ä»Šæ—¥</div>
                                </div>
                                <div class="card-metrics">
                                    <div class="metric">
                                        <div class="metric-value" id="todayDuration">0</div>
                                        <div class="metric-label">åˆ†é’Ÿ</div>
                                    </div>
                                    <div class="metric">
                                        <div class="metric-value" id="todayRecords">0</div>
                                        <div class="metric-label">è®°å½•</div>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-card week">
                                <div class="card-header">
                                    <div class="card-icon">ğŸ“Š</div>
                                    <div class="card-period">æœ¬å‘¨</div>
                                </div>
                                <div class="card-metrics">
                                    <div class="metric">
                                        <div class="metric-value" id="weekDuration">0</div>
                                        <div class="metric-label">å°æ—¶</div>
                                    </div>
                                    <div class="metric">
                                        <div class="metric-value" id="weekDays">0</div>
                                        <div class="metric-label">æ´»è·ƒå¤©æ•°</div>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-card month">
                                <div class="card-header">
                                    <div class="card-icon">ğŸ¯</div>
                                    <div class="card-period">æœ¬æœˆ</div>
                                </div>
                                <div class="card-metrics">
                                    <div class="metric">
                                        <div class="metric-value" id="monthDuration">0</div>
                                        <div class="metric-label">å°æ—¶</div>
                                    </div>
                                    <div class="metric">
                                        <div class="metric-value" id="monthStreak">0</div>
                                        <div class="metric-label">è¿ç»­å¤©æ•°</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Recent Records -->
                    <section class="recent-records">
                        <div class="section-header">
                            <h2 class="section-title">æœ€è¿‘è®°å½•</h2>
                            <a href="#/records" class="link-more">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
                        </div>
                        <div id="recentRecordsList" class="records-list">
                            <!-- Records will be inserted here -->
                        </div>
                    </section>
                </div>
            </div>

            <!-- Records Page -->
            <div id="recordsPage" class="page">
                <div class="container">
                    <div class="page-header">
                        <h1>å­¦ä¹ è®°å½•</h1>
                        <button class="btn btn-primary" onclick="app.showQuickRecord()">æ–°å»ºè®°å½•</button>
                    </div>
                    
                    <!-- Filters -->
                    <div class="filters">
                        <select class="filter-select" id="typeFilter">
                            <option value="">æ‰€æœ‰ç±»å‹</option>
                            <option value="video">è§†é¢‘</option>
                            <option value="podcast">æ’­å®¢</option>
                            <option value="book">ä¹¦ç±</option>
                            <option value="course">è¯¾ç¨‹</option>
                            <option value="article">æ–‡ç« </option>
                            <option value="exercise">é¢˜ç›®</option>
                            <option value="project">é¡¹ç›®</option>
                            <option value="workout">è¿åŠ¨</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                        <input type="text" class="filter-input" id="searchInput" placeholder="æœç´¢æ ‡é¢˜æˆ–å†…å®¹...">
                    </div>

                    <!-- Records List -->
                    <div id="recordsList" class="records-list full">
                        <!-- Records will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Record Detail Page -->
            <div id="recordDetailPage" class="page" style="display: none;">
                <div class="container">
                    <!-- Breadcrumb Navigation -->
                    <div class="breadcrumb">
                        <span class="breadcrumb-link" onclick="app.showPage('records')">å­¦ä¹ è®°å½•</span>
                        <span class="breadcrumb-separator">â€º</span>
                        <span class="breadcrumb-current">è®°å½•è¯¦æƒ…</span>
                    </div>
                    
                    <!-- Page Header -->
                    <div class="page-header">
                        <h1 id="recordDetailTitle">è®°å½•è¯¦æƒ…</h1>
                        <div class="page-actions">
                            <!-- æŒ‰é¡ºåºæ’åˆ—ï¼šç¼–è¾‘ â†’ è¿”å›åˆ—è¡¨ â†’ åˆ é™¤è®°å½• -->
                            <button class="btn btn-secondary" onclick="app.toggleEditMode()" id="editModeBtn">ç¼–è¾‘</button>
                            <button class="btn btn-secondary" onclick="app.cancelEdit()" id="cancelEditBtn" style="display: none;">å–æ¶ˆ</button>
                            <button class="btn btn-success" onclick="app.saveRecordDetail()" id="saveDetailBtn" style="display: none;">ä¿å­˜ä¿®æ”¹</button>
                            <button class="btn btn-secondary" onclick="app.showPage('records')">è¿”å›åˆ—è¡¨</button>
                            <button class="btn-delete-confirm" onclick="app.confirmDeleteRecord(app.currentRecordId)" id="deleteRecordBtn">åˆ é™¤è®°å½•</button>
                        </div>
                    </div>
                    
                    <!-- Record Detail Content - 3 Column Layout -->
                    <div class="record-detail-layout three-column">
                        <!-- Left Column: åŸºç¡€ä¿¡æ¯ + æ—¶é•¿ä¿¡æ¯ + å­¦ä¹ ä½“éªŒ -->
                        <div class="record-detail-left">
                            <div class="detail-section">
                                <h3>åŸºç¡€ä¿¡æ¯</h3>
                                <div class="detail-fields">
                                    <div class="detail-field">
                                        <label>è®°å½•æ ‡é¢˜</label>
                                        <input type="text" id="recordDetailTitleField" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>å­¦ä¹ å½¢å¼</label>
                                        <select id="recordDetailFormType" class="detail-select" disabled>
                                            <option value="video">ğŸ“¹ è§†é¢‘</option>
                                            <option value="podcast">ğŸ™ï¸ æ’­å®¢</option>
                                            <option value="book">ğŸ“š ä¹¦ç±</option>
                                            <option value="course">ğŸ“ è¯¾ç¨‹</option>
                                            <option value="article">ğŸ“„ æ–‡ç« </option>
                                            <option value="exercise">âœï¸ é¢˜ç›®</option>
                                            <option value="project">ğŸ’» é¡¹ç›®</option>
                                            <option value="workout">ğŸƒ è¿åŠ¨</option>
                                            <option value="other">ğŸ“Œ å…¶ä»–</option>
                                        </select>
                                    </div>
                                    <div class="detail-field">
                                        <label>å‘ç”Ÿæ—¶é—´</label>
                                        <input type="datetime-local" id="recordDetailOccurredAt" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>æ€»æ—¶é•¿ (åˆ†é’Ÿ)</label>
                                        <input type="number" id="recordDetailDuration" class="detail-input" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h3>å­¦ä¹ ä½“éªŒ</h3>
                                <div class="detail-fields">
                                    <div class="detail-field">
                                        <label>éš¾åº¦è¯„çº§</label>
                                        <div class="rating-display" id="recordDetailDifficulty">
                                            <span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span>
                                        </div>
                                    </div>
                                    <div class="detail-field">
                                        <label>ä¸“æ³¨åº¦</label>
                                        <div class="rating-display" id="recordDetailFocus">
                                            <span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span>
                                        </div>
                                    </div>
                                    <div class="detail-field">
                                        <label>ç²¾åŠ›çŠ¶æ€</label>
                                        <div class="rating-display" id="recordDetailEnergy">
                                            <span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span>
                                        </div>
                                    </div>
                                    <div class="detail-field">
                                        <label>å¿ƒæƒ…è®°å½•</label>
                                        <textarea id="recordDetailMood" class="detail-textarea" readonly></textarea>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        <!-- Middle Column: å­¦ä¹ ç¬”è®° -->
                        <div class="record-detail-middle">
                            <div class="detail-section">
                                <h3>å­¦ä¹ ç¬”è®°</h3>
                                <div class="detail-fields">
                                    <textarea id="recordDetailBodyMd" class="detail-textarea large" readonly placeholder="å­¦ä¹ ç¬”è®°å’Œè¯¦ç»†å†…å®¹..."></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: æ ‡ç­¾ç®¡ç† + å…³è”èµ„æº -->
                        <div class="record-detail-right">
                            <div class="detail-section">
                                <h3>æ ‡ç­¾ç®¡ç†</h3>
                                <div class="tags-display" id="recordDetailTags">
                                    <!-- Tags will be displayed here -->
                                </div>
                                <div class="tag-editor" id="tagEditor" style="display: none;">
                                    <input type="text" id="newTagInput" class="tag-input" placeholder="è¾“å…¥æ–°æ ‡ç­¾...">
                                    <button class="btn-small btn-primary" onclick="app.addTagToRecord()">æ·»åŠ </button>
                                </div>
                            </div>
                            
                            <div class="detail-section" id="resourceSection">
                                <h3>å…³è”èµ„æº</h3>
                                <div class="detail-fields" id="resourceFields">
                                    <div class="detail-field">
                                        <label>èµ„æºæ ‡é¢˜</label>
                                        <input type="text" id="resourceDetailTitle" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>èµ„æºç±»å‹</label>
                                        <select id="resourceDetailType" class="detail-select" disabled>
                                            <option value="video">è§†é¢‘</option>
                                            <option value="podcast">æ’­å®¢</option>
                                            <option value="book">ä¹¦ç±</option>
                                            <option value="course">è¯¾ç¨‹</option>
                                            <option value="article">æ–‡ç« </option>
                                            <option value="paper">è®ºæ–‡</option>
                                            <option value="exercise">ç»ƒä¹ </option>
                                            <option value="project">é¡¹ç›®</option>
                                            <option value="workout">è¿åŠ¨</option>
                                            <option value="other">å…¶ä»–</option>
                                        </select>
                                    </div>
                                    <div class="detail-field">
                                        <label>ä½œè€…ä¿¡æ¯</label>
                                        <input type="text" id="resourceDetailAuthor" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>èµ„æºé“¾æ¥</label>
                                        <input type="url" id="resourceDetailUrl" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>å¹³å°ä¿¡æ¯</label>
                                        <input type="text" id="resourceDetailPlatform" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>ISBN (ä»…ä¹¦ç±)</label>
                                        <input type="text" id="resourceDetailIsbn" class="detail-input" readonly>
                                    </div>
                                    <div class="detail-field">
                                        <label>èµ„æºæè¿°</label>
                                        <textarea id="resourceDetailDescription" class="detail-textarea" readonly></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section" id="userResourceSection" style="display: none;">
                                <h3>ä¸ªäººèµ„æºå…³ç³»</h3>
                                <div class="detail-fields">
                                    <div class="detail-field">
                                        <label>èµ„æºçŠ¶æ€</label>
                                        <select id="userResourceStatus" class="detail-select" disabled>
                                            <option value="wishlist">å¾…å­¦ä¹ </option>
                                            <option value="learning">å­¦ä¹ ä¸­</option>
                                            <option value="paused">å·²æš‚åœ</option>
                                            <option value="done">å·²å®Œæˆ</option>
                                            <option value="reviewing">å¤ä¹ ä¸­</option>
                                        </select>
                                    </div>
                                    <div class="detail-field">
                                        <label>ä¸ªäººè¯„åˆ†</label>
                                        <div class="rating-display" id="userResourceRating">
                                            <span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span><span class="star">â˜†</span>
                                        </div>
                                    </div>
                                    <div class="detail-field">
                                        <label>ç®€çŸ­è¯„ä»·</label>
                                        <textarea id="userResourceReview" class="detail-textarea" readonly></textarea>
                                    </div>
                                    <div class="detail-field">
                                        <label>æ”¶è—çŠ¶æ€</label>
                                        <div class="favorite-toggle">
                                            <input type="checkbox" id="userResourceFavorite" disabled>
                                            <label for="userResourceFavorite">æ”¶è—æ­¤èµ„æº</label>
                                        </div>
                                    </div>
                                    <div class="detail-field">
                                        <label>ç´¯è®¡å­¦ä¹ æ—¶é•¿</label>
                                        <div class="readonly-field" id="userResourceTotalDuration">0 åˆ†é’Ÿ</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section" id="assetsSection" style="display: none;">
                                <h3>é™„ä»¶èµ„æº</h3>
                                <div class="assets-display" id="recordDetailAssets">
                                    <!-- Assets will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analyticsPage" class="page">
                <div class="container">
                    <h1 class="page-title">æ•°æ®åˆ†æ</h1>
                    
                    <!-- Time Stats and Calendar Row -->
                    <section class="stats-row">
                        <!-- Time Stats -->
                        <div class="time-stats-container">
                            <div class="section-header">
                                <h2 class="section-title">å­¦ä¹ æ—¶é•¿è¶‹åŠ¿</h2>
                                <div class="period-tabs">
                                    <button class="period-tab active" data-period="week" onclick="app.switchPeriod('week')">å‘¨</button>
                                    <button class="period-tab" data-period="month" onclick="app.switchPeriod('month')">æœˆ</button>
                                    <button class="period-tab" data-period="year" onclick="app.switchPeriod('year')">å¹´</button>
                                </div>
                            </div>
                            <div class="chart-container">
                                <div id="durationChart" class="chart-placeholder">
                                    <div class="chart-bars" id="chartBars">
                                        <!-- Chart bars will be generated here -->
                                    </div>
                                    <div class="chart-labels" id="chartLabels">
                                        <!-- Chart labels will be generated here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Calendar Widget -->
                        <div class="calendar-widget">
                            <div class="widget-header">
                                <h3>æ‰“å¡æ—¥å†</h3>
                                <div class="calendar-nav-mini">
                                    <button class="nav-btn" onclick="app.changeMonth(-1)">â€¹</button>
                                    <span id="miniCalendarMonth">2024å¹´1æœˆ</span>
                                    <button class="nav-btn" onclick="app.changeMonth(1)">â€º</button>
                                </div>
                            </div>
                            <div id="miniCalendarGrid" class="mini-calendar-grid">
                                <!-- Mini calendar will be generated here -->
                            </div>
                        </div>
                    </section>

                    <!-- Category Stats -->
                    <section class="stats-section">
                        <h2 class="section-title">å­¦ä¹ åˆ†æ</h2>
                        <div class="stats-grid-three">
                            <div class="stat-card">
                                <h3>å­¦ä¹ å½¢å¼åˆ†å¸ƒ</h3>
                                <div id="typeStats" class="stat-list">
                                    <!-- Stats will be inserted here -->
                                </div>
                            </div>
                            <div class="stat-card">
                                <h3>çƒ­é—¨ä¸»é¢˜</h3>
                                <div id="weeklyTopics" class="stat-list">
                                    <!-- Stats will be inserted here -->
                                </div>
                            </div>
                            <div class="stat-card">
                                <h3>é‡Œç¨‹ç¢‘æˆå°±</h3>
                                <div class="milestone-mini-list">
                                    <div class="milestone-mini-item">
                                        <div class="milestone-mini-icon">ğŸ¯</div>
                                        <div class="milestone-mini-content">
                                            <span class="milestone-mini-title">ç´¯è®¡100å°æ—¶</span>
                                            <span class="milestone-mini-date">2024-01-20</span>
                                        </div>
                                    </div>
                                    <div class="milestone-mini-item">
                                        <div class="milestone-mini-icon">ğŸ“š</div>
                                        <div class="milestone-mini-content">
                                            <span class="milestone-mini-title">è¿ç»­å­¦ä¹ 21å¤©</span>
                                            <span class="milestone-mini-date">2024-01-18</span>
                                        </div>
                                    </div>
                                    <div class="milestone-mini-item">
                                        <div class="milestone-mini-icon">ğŸ†</div>
                                        <div class="milestone-mini-content">
                                            <span class="milestone-mini-title">å®Œæˆ5ä¸ªé¡¹ç›®</span>
                                            <span class="milestone-mini-date">2024-01-15</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- AI Summary -->
                    <section class="ai-summary">
                        <h2 class="section-title">AI æ™ºèƒ½æ€»ç»“</h2>
                        <div class="summary-content">
                            <div class="summary-insights">
                                <div class="insight-item">
                                    <div class="insight-icon">ğŸ“ˆ</div>
                                    <div class="insight-text">
                                        <strong>å­¦ä¹ è¶‹åŠ¿ï¼š</strong>
                                        <span id="trendInsight">æœ¬æœˆå­¦ä¹ æ—¶é•¿ç›¸æ¯”ä¸Šæœˆå¢é•¿25%ï¼Œä¿æŒè‰¯å¥½ä¸Šå‡è¶‹åŠ¿</span>
                                    </div>
                                </div>
                                <div class="insight-item">
                                    <div class="insight-icon">ğŸ¯</div>
                                    <div class="insight-text">
                                        <strong>é‡ç‚¹æ–¹å‘ï¼š</strong>
                                        <span id="focusInsight">AIå’Œç¼–ç¨‹æ˜¯ä½ çš„ä¸»è¦å­¦ä¹ æ–¹å‘ï¼Œå æ€»æ—¶é•¿çš„65%</span>
                                    </div>
                                </div>
                                <div class="insight-item">
                                    <div class="insight-icon">â­</div>
                                    <div class="insight-text">
                                        <strong>ä¼˜åŠ¿è¡¨ç°ï¼š</strong>
                                        <span id="strengthInsight">è§†é¢‘å­¦ä¹ æ•ˆç‡æœ€é«˜ï¼Œå¹³å‡ä¸“æ³¨åº¦è¾¾åˆ°4.5/5</span>
                                    </div>
                                </div>
                            </div>
                            <div class="next-action">
                                <div class="action-header">
                                    <strong>ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®</strong>
                                </div>
                                <div class="action-content">
                                    <span id="nextActionText">å»ºè®®ç»§ç»­åŠ å¼ºå®è·µé¡¹ç›®ï¼Œå¯ä»¥å°è¯•å°†ç†è®ºçŸ¥è¯†åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œæé«˜å­¦ä¹ è½¬åŒ–ç‡</span>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

        </main>

        <!-- Quick Record Modal -->
        <div id="quickRecordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>å¿«é€Ÿè®°å½•</h2>
                    <button class="modal-close" onclick="app.closeQuickRecord()">Ã—</button>
                </div>
                <div class="modal-body">
                    <!-- Tab Navigation -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="app.switchRecordTab('form')">è¡¨å•è®°å½•</button>
                        <button class="tab-btn" onclick="app.switchRecordTab('quick')">éšæ‰‹è®°</button>
                    </div>

                    <!-- Form Record -->
                    <div id="formRecord" class="tab-content active">
                        <form id="recordForm" class="record-form">
                            <!-- Step 1: Title -->
                            <div class="form-step active" data-step="1">
                                <label class="form-label">æ ‡é¢˜</label>
                                <input type="text" class="form-input" id="recordTitle" placeholder="è¾“å…¥å­¦ä¹ å†…å®¹æ ‡é¢˜..." required>
                            </div>

                            <!-- Step 2: Type -->
                            <div class="form-step" data-step="2">
                                <label class="form-label">é€‰æ‹©å½¢å¼ç±»åˆ«</label>
                                <div class="type-grid">
                                    <button type="button" class="type-btn" data-type="video">ğŸ“¹ è§†é¢‘</button>
                                    <button type="button" class="type-btn" data-type="podcast">ğŸ™ï¸ æ’­å®¢</button>
                                    <button type="button" class="type-btn" data-type="book">ğŸ“š ä¹¦ç±</button>
                                    <button type="button" class="type-btn" data-type="course">ğŸ“ è¯¾ç¨‹</button>
                                    <button type="button" class="type-btn" data-type="article">ğŸ“„ æ–‡ç« </button>
                                    <button type="button" class="type-btn" data-type="exercise">âœï¸ é¢˜ç›®</button>
                                    <button type="button" class="type-btn" data-type="project">ğŸ’» é¡¹ç›®</button>
                                    <button type="button" class="type-btn" data-type="workout">ğŸƒ è¿åŠ¨</button>
                                    <button type="button" class="type-btn" data-type="other">ğŸ“Œ å…¶ä»–</button>
                                </div>
                            </div>

                            <!-- Step 3: Categories -->
                            <div class="form-step" data-step="3">
                                <label class="form-label">å†…å®¹æ ‡ç­¾ï¼ˆå¯å¤šé€‰ï¼‰</label>
                                <div class="tag-input-container">
                                    <input type="text" class="tag-input" id="tagInput" placeholder="è¾“å…¥æ ‡ç­¾ï¼Œå¦‚ï¼šè‹±è¯­ã€ç¼–ç¨‹ã€AI...">
                                    <div class="tag-suggestions">
                                        <span class="tag-suggestion">è‹±è¯­</span>
                                        <span class="tag-suggestion">AI</span>
                                        <span class="tag-suggestion">æ•°å­¦</span>
                                        <span class="tag-suggestion">ç¼–ç¨‹</span>
                                        <span class="tag-suggestion">å†å²</span>
                                    </div>
                                </div>
                                <div class="selected-tags" id="selectedTags"></div>
                            </div>

                            <!-- Step 4: Duration -->
                            <div class="form-step" data-step="4">
                                <label class="form-label">å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                                <input type="number" class="form-input" id="recordDuration" placeholder="25" min="1">
                                <div class="duration-presets">
                                    <button type="button" class="preset-btn" data-duration="25">25åˆ†é’Ÿ</button>
                                    <button type="button" class="preset-btn" data-duration="45">45åˆ†é’Ÿ</button>
                                    <button type="button" class="preset-btn" data-duration="60">1å°æ—¶</button>
                                    <button type="button" class="preset-btn" data-duration="90">1.5å°æ—¶</button>
                                </div>
                            </div>

                            <!-- Step 5: Feedback -->
                            <div class="form-step" data-step="5">
                                <label class="form-label">åé¦ˆï¼ˆå¯é€‰ï¼‰</label>
                                <div class="feedback-grid">
                                    <div class="feedback-item">
                                        <label>éš¾åº¦</label>
                                        <div class="rating" data-field="difficulty">
                                            <span class="star" data-value="1">â˜†</span>
                                            <span class="star" data-value="2">â˜†</span>
                                            <span class="star" data-value="3">â˜†</span>
                                            <span class="star" data-value="4">â˜†</span>
                                            <span class="star" data-value="5">â˜†</span>
                                        </div>
                                    </div>
                                    <div class="feedback-item">
                                        <label>ä¸“æ³¨åº¦</label>
                                        <div class="rating" data-field="focus">
                                            <span class="star" data-value="1">â˜†</span>
                                            <span class="star" data-value="2">â˜†</span>
                                            <span class="star" data-value="3">â˜†</span>
                                            <span class="star" data-value="4">â˜†</span>
                                            <span class="star" data-value="5">â˜†</span>
                                        </div>
                                    </div>
                                </div>
                                <textarea class="form-textarea" id="recordMood" placeholder="è®°å½•ä½ çš„æ€è€ƒå’Œæ„Ÿå—..."></textarea>
                            </div>

                            <!-- Form Navigation -->
                            <div class="form-nav">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-secondary" onclick="app.prevStep()">ä¸Šä¸€æ­¥</button>
                                    <button type="button" class="btn btn-primary" onclick="app.nextStep()">ä¸‹ä¸€æ­¥</button>
                                    <button type="submit" class="btn btn-success" style="display:none;">å®Œæˆè®°å½•</button>
                                </div>
                                
                                <!-- Detailed Record Link -->
                                <div class="detailed-record-link">
                                    <a href="javascript:void(0)" onclick="app.createNewDetailedRecord()">
                                        éœ€è¦å¡«å†™æ›´å¤šä¿¡æ¯ï¼Ÿå‰å¾€è¯¦ç»†è®°å½• â†’
                                    </a>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Quick Note -->
                    <div id="quickNote" class="tab-content">
                        <div class="quick-note-form">
                            <textarea class="quick-input" placeholder="è®°å½•ä¸€å¥è¯ã€ç²˜è´´é“¾æ¥æˆ–ä¸Šä¼ å›¾ç‰‡..." rows="4"></textarea>
                            <div class="quick-actions">
                                <button class="btn-icon-action" title="ä¸Šä¼ å›¾ç‰‡">ğŸ“·</button>
                                <button class="btn-icon-action" title="æ·»åŠ é“¾æ¥">ğŸ”—</button>
                            </div>
                            <button class="btn btn-primary btn-block" onclick="app.saveQuickNote()">æ™ºèƒ½è¯†åˆ«å¹¶ä¿å­˜</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Include Environment Variables -->
    <script src="js/env.js"></script>
    <!-- Include Cache Service (temporarily disabled) -->
    <!-- <script src="js/cache-service.js?v=20250827-1"></script> -->
    <!-- Include Authentication Service -->
    <script src="js/auth.js?v=20250825-6"></script>
    <!-- Include API Service -->
    <script src="js/api-service.js?v=20250827-nocache"></script>
    <!-- Include Main Application -->
    <script src="js/app.js?v=20250827-fixicons"></script>
    
    <script>
        let isRedirecting = false; // é˜²æ­¢é‡å¤é‡å®šå‘

        // Authentication check and redirect logic
        document.addEventListener('DOMContentLoaded', () => {
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿è®¤è¯æœåŠ¡å®Œå…¨åˆå§‹åŒ–
            setTimeout(() => {
                console.log('ğŸ” æ£€æŸ¥é¦–é¡µè®¤è¯çŠ¶æ€:', authService.isAuthenticated());
                
                // Check authentication status
                if (!authService.isAuthenticated() && !isRedirecting) {
                    console.log('âŒ æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ');
                    isRedirecting = true;
                    window.location.href = 'login.html';
                    return;
                }
                
                // å¦‚æœå·²ç™»å½•ï¼Œæ›´æ–°ç”¨æˆ·æ˜¾ç¤º
                if (authService.isAuthenticated()) {
                    updateUserDisplay(authService.getCurrentUser());
                }
                
                // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
                authService.onAuthStateChange((user) => {
                    console.log('ğŸ‘¤ é¦–é¡µè®¤è¯çŠ¶æ€å˜åŒ–:', !!user);
                    if (!user && !isRedirecting) {
                        isRedirecting = true;
                        window.location.href = 'login.html';
                    } else if (user) {
                        updateUserDisplay(user);
                    }
                });
            }, 100);
        });

        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œå½“ä»ä¸ªäººèµ„æ–™é¡µé¢è¿”å›æ—¶åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
        document.addEventListener('visibilitychange', async () => {
            if (!document.hidden && authService.isAuthenticated()) {
                console.log('ğŸ”„ é¡µé¢é‡æ–°å¯è§ï¼Œåˆ·æ–°ç”¨æˆ·ä¿¡æ¯');
                await updateUserDisplay(authService.getCurrentUser());
            }
        });

        // ç›‘å¬localStorageä¸­çš„å¤´åƒæ›´æ–°äº‹ä»¶
        window.addEventListener('storage', (event) => {
            if (event.key === 'avatarUpdated' && authService.isAuthenticated()) {
                console.log('ğŸ“¸ æ£€æµ‹åˆ°å¤´åƒæ›´æ–°äº‹ä»¶');
                // å»¶è¿Ÿä¸€ç‚¹å†åˆ·æ–°ï¼Œç¡®ä¿å­˜å‚¨æ“ä½œå®Œæˆ
                setTimeout(async () => {
                    await updateUserDisplay(authService.getCurrentUser());
                }, 100);
            }
        });

        // ç›‘å¬æ¥è‡ªä¸ªäººèµ„æ–™é¡µé¢çš„æ¶ˆæ¯
        window.addEventListener('message', (event) => {
            if (event.data.type === 'AVATAR_UPDATED' && authService.isAuthenticated()) {
                console.log('ğŸ“¸ æ”¶åˆ°å¤´åƒæ›´æ–°æ¶ˆæ¯:', event.data.avatarUrl);
                setTimeout(async () => {
                    await updateUserDisplay(authService.getCurrentUser());
                }, 100);
            }
        });
        
        async function updateUserDisplay(user) {
            try {
                // è·å–å®Œæ•´çš„ç”¨æˆ·èµ„æ–™ä¿¡æ¯
                const profile = await window.apiService.request('/profiles/current', 'GET');
                
                if (profile && !profile.error) {
                    const displayName = profile.display_name || authService.getDisplayName();
                    const userEmail = profile.email || user?.email || 'demo@example.com';
                    const avatarUrl = profile.avatar_url;
                    
                    // Update main user name
                    const userNameElement = document.querySelector('.user-name');
                    if (userNameElement && displayName) {
                        userNameElement.textContent = displayName;
                    }
                    
                    // Update main user avatar
                    const userAvatarElement = document.querySelector('.user-avatar');
                    if (userAvatarElement) {
                        if (avatarUrl) {
                            userAvatarElement.innerHTML = `<img src="${avatarUrl}" alt="å¤´åƒ" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">`;
                        } else {
                            userAvatarElement.innerHTML = '<span class="avatar-icon">ğŸ‘¤</span>';
                        }
                    }
                    
                    // Update dropdown menu info
                    const menuNameElement = document.querySelector('.user-menu-name');
                    const menuEmailElement = document.querySelector('.user-menu-email');
                    const menuAvatarElement = document.querySelector('.user-menu-avatar');
                    
                    if (menuNameElement && displayName) {
                        menuNameElement.textContent = displayName;
                    }
                    if (menuEmailElement && userEmail) {
                        menuEmailElement.textContent = userEmail;
                    }
                    if (menuAvatarElement) {
                        if (avatarUrl) {
                            menuAvatarElement.innerHTML = `<img src="${avatarUrl}" alt="å¤´åƒ" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`;
                        } else {
                            menuAvatarElement.innerHTML = '<span class="avatar-icon">ğŸ‘¤</span>';
                        }
                    }
                    
                    console.log('âœ… ç”¨æˆ·æ˜¾ç¤ºä¿¡æ¯æ›´æ–°æˆåŠŸ', { displayName, avatarUrl });
                } else {
                    // å¦‚æœè·å–èµ„æ–™å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€ä¿¡æ¯
                    console.log('âš ï¸ æ— æ³•è·å–ç”¨æˆ·èµ„æ–™ï¼Œä½¿ç”¨åŸºç¡€ä¿¡æ¯');
                    const displayName = authService.getDisplayName();
                    const userEmail = user?.email || 'demo@example.com';
                    
                    // Update main user name
                    const userNameElement = document.querySelector('.user-name');
                    if (userNameElement && displayName) {
                        userNameElement.textContent = displayName;
                    }
                    
                    // Update dropdown menu info
                    const menuNameElement = document.querySelector('.user-menu-name');
                    const menuEmailElement = document.querySelector('.user-menu-email');
                    if (menuNameElement && displayName) {
                        menuNameElement.textContent = displayName;
                    }
                    if (menuEmailElement && userEmail) {
                        menuEmailElement.textContent = userEmail;
                    }
                }
            } catch (error) {
                console.error('âŒ æ›´æ–°ç”¨æˆ·æ˜¾ç¤ºä¿¡æ¯å¤±è´¥:', error);
                // å‡ºé”™æ—¶ä½¿ç”¨åŸºç¡€ä¿¡æ¯
                const displayName = authService.getDisplayName();
                const userEmail = user?.email || 'demo@example.com';
                
                const userNameElement = document.querySelector('.user-name');
                if (userNameElement && displayName) {
                    userNameElement.textContent = displayName;
                }
            }
        }
        
        // User menu functions
        function toggleUserMenu() {
            const userMenu = document.getElementById('userMenu');
            const userProfile = document.querySelector('.user-profile');
            
            userMenu.classList.toggle('show');
            userProfile.classList.toggle('open');
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', (event) => {
            const userMenu = document.getElementById('userMenu');
            const userProfile = document.querySelector('.user-profile');
            
            if (!userProfile.contains(event.target)) {
                userMenu.classList.remove('show');
                userProfile.classList.remove('open');
            }
        });
        
        async function handleLogout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                try {
                    const { error } = await authService.signOut();
                    if (error) {
                        alert('é€€å‡ºç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
                    } else {
                        // æˆåŠŸç™»å‡ºï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢
                        window.location.href = 'login.html';
                    }
                } catch (error) {
                    alert('é€€å‡ºç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
        }
        
        function showProfile() {
            console.log('ğŸ“ ç‚¹å‡»ä¸ªäººèµ„æ–™èœå•');
            toggleUserMenu(); // Close the menu
            
            // å»¶è¿Ÿä¸€ç‚¹å†è·³è½¬ï¼Œç¡®ä¿èœå•å…³é—­åŠ¨ç”»ä¸ä¼šå¹²æ‰°
            setTimeout(() => {
                console.log('ğŸ”„ è·³è½¬åˆ°ä¸ªäººèµ„æ–™é¡µé¢');
                window.location.href = 'profile.html';
            }, 50);
        }
        
        function showSettings() {
            alert('è®¾ç½®åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
            toggleUserMenu(); // Close the menu
        }
    </script>
</body>
</html>